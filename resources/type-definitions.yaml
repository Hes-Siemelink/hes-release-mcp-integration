# JSON Schema: https://raw.githubusercontent.com/digital-ai/release-api/main/synthetic-type-definitions/type-definition-schema.json
#
# Yaml-based format to define types in Release, as an alternative to synthetic.xml or type-definitions.xml
# This format is in Tech Preview in Release 23.3 and may change in future versions.
#
# You can also use synthetic.xml or type-definitions.xml to define types. Note that contents of the two files
# are merged. This means that you can't have the same type definition in both
# type-definitions.yaml and synthetic.xml or type-definitions.xml at the same time.

types:

  #
  # MCP
  #

  # MCP Server

  mcp.Server:
    extends: configuration.ContainerHttpConnection

    properties:
      url:
        description: The target MCP Server URL
        required: true
      transport:
        label: Transport Protocol
        description: The transport protocol to use
        kind: enum
        default: http
        enum-values:
          - http
          - sse
      headers:
        description: Additional HTTP headers to include in requests
        kind: map_string_string
        required: false

    hidden-properties:
      testConnectionScript: mcp.TestConnection

  # MCP tasks

  mcp.BaseTask:
    extends: xlrelease.ContainerTask
    virtual: true

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: mcp.png
      taskColor: "#5F5FFF"

    input-properties:
      server:
        description: The MCP server
        kind: ci
        referenced-type: mcp.Server

  mcp.CallTool:
    extends: mcp.BaseTask
    description: Calls an MCP tool

    input-properties:
      tool:
        description: The name of the tool to call
        kind: string
        input-hint:
          method-ref: tool-lookup

      input:
        description: The input as a JSON string.
        kind: string
        size: large
        required: false

    output-properties:
      result:
        kind: string

    methods:
      tool-lookup:
        delegate: remoteScriptLookup
        script: mcp.ToolLookupScript
        containerConnection: server

  mcp.ListTools:
    extends: mcp.BaseTask
    description: Lists available tools on the MCP server

    output-properties:
      tools:
        label: Tool definitions
        description: The available tools on the MCP server and their descriptions
        kind: map_string_string

      inputSchema:
        label: Input schema
        description: The input schema for each tool
        kind: map_string_string

  # MCP Scripts

  mcp.BaseScript:
    extends: xlrelease.RemoteScriptExecution
    virtual: true

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true

    output-properties:
      commandResponse:
        kind: map_string_string

  mcp.TestConnection:
    extends: mcp.BaseScript

    input-properties:
      server:
        kind: ci
        referenced-type: mcp.Server

  mcp.ToolLookupScript:
    extends: mcp.BaseScript

    input-properties:
      _ci:
        kind: ci
        referenced-type: mcp.BaseTask
      _attributes:
        kind: map_string_string
      _parameters:
        kind: ci
        referenced-type: udm.Parameters

  #
  # AI Models
  #

  ai.Model:
    extends: xlrelease.Configuration
    virtual: true

    properties:
      apiKey:
        label: API Key
        description: API Key for the LLM provider
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string

  ai.GeminiModel:
    extends: ai.Model

    hidden-properties:
      provider:
        default: gemini

    properties:
      apiKey:
        label: Gemini API Key
        description: API Key for Google Gemini
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string
        default: gemini-2.5-flash

  ai.OpenAiModel:
    extends: ai.Model

    hidden-properties:
      provider:
        default: openai

    properties:
      url:
        label: API URL
        description: The URL to each the OpenAI API
        kind: string
        default: https://api.openai.com/v1/chat/completions
      apiKey:
        label: API Key
        description: API Key for the LLM provider
        required: true
        password: true
      model_id:
        label: Model
        description: The model to use
        kind: string

  #
  # Prompts
  #

  ai.LlmPrompt:
    extends: xlrelease.ContainerTask
    label: "AI: Prompt"
    description: Sends a prompt to an LLM service

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: gemini.png
      taskColor: "#C88BFF"

    input-properties:
      prompt:
        description: The prompt to be answered by the AI model
        kind: string
        size: large
      model:
        description: The LLM model to use
        kind: ci
        referenced-type: ai.Model

    output-properties:
      response:
        description: The AI response
        kind: string

  #
  # Langchain
  #

  ai.AgentPrompt:
    extends: xlrelease.ContainerTask
    label: "AI: Agent prompt"
    description: Prompts an AI agent to do something with the help of multiple MCP servers.

    hidden-properties:
      image:
        default: "@registry.url@/@registry.org@/@project.name@:@project.version@"
        transient: true
      iconLocation: agent.png
      taskColor: "#EE9037"

    input-properties:
      prompt:
        description: The prompt to send to the agent
        kind: string
        size: large
      model:
        description: The LLM model to use
        kind: ci
        referenced-type: ai.Model
      mcpServer1:
        label: MCP Server 1
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: mcp.Server
      mcpServer2:
        label: MCP Server 2
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: mcp.Server
      mcpServer3:
        label: MCP Server 3
        description: An MCP server that can be used by the agent
        kind: ci
        referenced-type: mcp.Server

    output-properties:
      result:
        description: The result returned by the agent
        kind: string
